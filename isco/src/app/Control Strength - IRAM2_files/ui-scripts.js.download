
// Sidebar

var offcanvasToggleBtn = document.querySelector('.sidebar-toggler');
var sidebarLeft = document.querySelector('#sidebar-left');
var sidebarMask = document.querySelector('#sidebar-mask');
var sidebarLink = document.querySelectorAll('.sidebar-menu li a');

function offcanvasToggle() {
    sidebarLeft.classList.toggle('show');
    sidebarMask.classList.toggle('show');
}

offcanvasToggleBtn.onclick = offcanvasToggle;
sidebarMask.onclick = offcanvasToggle;

for (var i = 0; i < sidebarLink.length; i++) {
    sidebarLink[i].addEventListener('click', function (event) {
        offcanvasToggle();
    });
}


// Sidebar search

var sidebarSearchInput, filter, ul, li, sidebarLinkTxt, txtValue, collapse, collapseTitle, separator, btnResetSidebarSearch;


function sidebarSearch() {
    sidebarSearchInput = document.getElementById('sidebarSearchInput');
    filter = sidebarSearchInput.value.toUpperCase();
    ul = document.getElementById("sidebar-left");
    li = ul.querySelectorAll(".nav-item");
    collapse = ul.querySelectorAll(".collapse");
    collapseTitle = ul.querySelectorAll(".nav-section-title");
    separator = ul.querySelectorAll(".separator");
    btnResetSidebarSearch = document.getElementById("reset-sidebar-search");


    if (sidebarSearchInput.value.length > 0) {
        btnResetSidebarSearch.classList.add("search-mode-show");
        showOnSearch(collapse);
        hideOnSearch(separator);
        hideOnSearch(collapseTitle);
    } else {
        sidebarSearchReset();
    }

    // Loop through all list items, and hide those who don't match the search query
    for (i = 0; i < li.length; i++) {
        sidebarLinkTxt = li[i].getElementsByTagName("a")[0];
        txtValue = sidebarLinkTxt.textContent || sidebarLinkTxt.innerText;

        sidebarLinkTxt.addEventListener('click', function (event) {
            sidebarSearchReset();
        });

        if (txtValue.toUpperCase().indexOf(filter) > -1) {
            li[i].classList.remove("search-mode-hide");
            li[i].classList.add("search-mode-show");
        } else {
            li[i].classList.remove("search-mode-show");
            li[i].classList.add("search-mode-hide");
        }
    }
}


function sidebarSearchReset() {
    btnResetSidebarSearch.classList.remove("search-mode-show");
    resetOnSearch(li);
    resetOnSearch(collapse);
    resetOnSearch(separator);
    resetOnSearch(collapseTitle);
    sidebarSearchInput.value = '';
}

function hideOnSearch(el) {
    for (i = 0; i < el.length; i++) {
        el[i].classList.remove("search-mode-show");
        el[i].classList.add("search-mode-hide");
    }
}

function showOnSearch(el) {
    for (i = 0; i < el.length; i++) {
        el[i].classList.remove("search-mode-hide");
        el[i].classList.add("search-mode-show");
    }
}

function resetOnSearch(el) {
    for (i = 0; i < el.length; i++) {
        el[i].classList.remove("search-mode-hide");
        el[i].classList.remove("search-mode-show");
    }
}



// Replace all SVG images with inline SVG

//document.querySelectorAll('.logo-svg').forEach(function (img) {
//    var imgID = img.id;
//    var imgClass = img.className;
//    var imgURL = img.src;

//    fetch(imgURL).then(function (response) {
//        return response.text();
//    }).then(function (text) {

//        var parser = new DOMParser();
//        var xmlDoc = parser.parseFromString(text, "text/xml");

//        // Get the SVG tag, ignore the rest
//        var svg = xmlDoc.getElementsByTagName('svg')[0];

//        // Add replaced image's ID to the new SVG
//        if (typeof imgID !== 'undefined') {
//            svg.setAttribute('id', imgID);
//        }
//        // Add replaced image's classes to the new SVG
//        if (typeof imgClass !== 'undefined') {
//            svg.setAttribute('class', imgClass + ' replaced-svg');
//        }

//        // Remove any invalid XML tags as per http://validator.w3.org
//        svg.removeAttribute('xmlns:a');

//        // Check if the viewport is set, if the viewport is not set the SVG wont't scale.
//        if (!svg.getAttribute('viewBox') && svg.getAttribute('height') && svg.getAttribute('width')) {
//            svg.setAttribute('viewBox', '0 0 ' + svg.getAttribute('height') + ' ' + svg.getAttribute('width'))
//        }

//        // Replace image with new SVG
//        img.parentNode.replaceChild(svg, img);

//    });

//});


// Title bar on scroll

//var divTop = $('.title-bar').offset().top;
//var titleBarHeight = $('.title-bar').outerHeight();
//var navbarHeight = $('#main-menu').outerHeight();

//$(window).resize(function () {
//    titleBarHeight = $('.title-bar').outerHeight();
//    navbarHeight = $('#main-menu').outerHeight();
//});

//$(window).scroll(function () {

//    if ($(window).scrollTop() >= divTop + 30) {
//        $('.title-bar').addClass('sticky');
//        $('.title-bar').css('top', navbarHeight);
//        append(top);
//    }
//    else {
//        $('.title-bar').removeClass('sticky');
//        $('.title-bar').removeAttr("style");
//        append();
//    }

//});


function append(position) {
    if (position == top) {
        $('.page-content').css('padding-top', titleBarHeight + 30);
    }
    else {
        $('.page-content').removeAttr("style");
    }
}
$('.menuItem').on('click', function () {
    $('#navbarSupportedContent').removeClass('show');
});

//check if any menu item is active - if any, make sure the dropdown is displayed and won't be closed
checkMenu();
$('nav#main-menu a').on('click', function () {
    if (!$(this).hasClass('dropdown-toggle') && !$(this).hasClass('dropdown-item')) {
        $('nav#main-menu li.dropdown, nav#main-menu li.dropdown ul, nav#main-menu li.dropdown ul li a').removeClass('active').removeClass('show');
        $('nav#main-menu .dropdown-bg').removeClass('show');
    }
    if ($(this).hasClass('dropdown-toggle') || $(this).hasClass('dropdown-toggle--organisation')) {
        //clear all active ones firsts
        $('nav#main-menu li.dropdown, nav#main-menu li.dropdown ul, nav#main-menu li.dropdown ul li a').removeClass('active').removeClass('show');
        //parent should have active class
        $(this).parents('li.nav-item.dropdown').addClass('show').addClass('active');
        //show background
        $('nav#main-menu .dropdown-bg').addClass('show');
    }
    centreSecondaryMenu();
});
function checkMenu() {
    if ($('nav#main-menu li.dropdown li a.active').length) {
        $('nav#main-menu li.dropdown li a.active').parents('ul').addClass('show');
        $('nav#main-menu li.dropdown li a.active').parents('li.nav-item.dropdown').addClass('show').addClass('active');
        $('nav#main-menu .dropdown-bg').addClass('show');
    }
    centreSecondaryMenu();
}
function centreSecondaryMenu() {
    if ($('nav#main-menu .dropdown.show').length) {
        let w = $('nav#main-menu .dropdown.show ul.dropdown-menu').width();
        $('nav#main-menu .dropdown.show ul.dropdown-menu').css({ 'right': 'auto', 'left': -1 * (w / 2) });
    }
}

